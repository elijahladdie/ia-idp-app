<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Console - Login</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container" style="max-width: 400px; margin-top: 5rem;">
        <div class="card">
            <div class="text-center mb-3">
                <h1 style="color: #2c3e50; margin-bottom: 0.5rem;">IdP Admin Console</h1>
                <p style="color: #7f8c8d;">Please sign in to access the admin console</p>
            </div>

            <div id="errorMessage" class="alert alert-error hidden"></div>
            <div id="successMessage" class="alert alert-success hidden"></div>

            <form id="loginForm" method="post" action="/admin/login">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" class="form-control" 
                           placeholder="Enter your email" required>
                </div>

                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" class="form-control" 
                           placeholder="Enter your password" required>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Sign In
                    </button>
                </div>
            </form>

            <div class="text-center mt-3">
                <p style="color: #7f8c8d; font-size: 0.9rem;">
                    Don't have an admin account? 
                    <a href="#" onclick="toggleRegisterForm()" style="color: #3498db;">Register as Admin</a>
                </p>
            </div>
        </div>

        <!-- Admin Registration Form -->
        <div id="registerForm" class="card hidden mt-3">
            <div class="text-center mb-3">
                <h2 style="color: #2c3e50; margin-bottom: 0.5rem;">Register Admin Account</h2>
                <p style="color: #7f8c8d;">Create a new admin account to access the console</p>
            </div>

            <form id="adminRegisterForm" method="post" action="/admin/register">
                <div class="form-group">
                    <label for="regEmail">Email Address</label>
                    <input type="email" id="regEmail" name="email" class="form-control" 
                           placeholder="Enter your email" required>
                </div>

                <div class="form-group">
                    <label for="regFirstName">First Name</label>
                    <input type="text" id="regFirstName" name="firstName" class="form-control" 
                           placeholder="Enter your first name" required>
                </div>

                <div class="form-group">
                    <label for="regLastName">Last Name</label>
                    <input type="text" id="regLastName" name="lastName" class="form-control" 
                           placeholder="Enter your last name" required>
                </div>

                <div class="form-group">
                    <label for="regPassword">Password</label>
                    <input type="password" id="regPassword" name="password" class="form-control" 
                           placeholder="Enter your password" required minlength="8">
                    <small style="color: #7f8c8d; font-size: 0.8rem;">
                        Password must be at least 8 characters long
                    </small>
                </div>

                <div class="form-group">
                    <label for="regConfirmPassword">Confirm Password</label>
                    <input type="password" id="regConfirmPassword" name="confirmPassword" class="form-control" 
                           placeholder="Confirm your password" required>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-success" style="width: 100%;">
                        Register Admin Account
                    </button>
                </div>

                <div class="text-center">
                    <a href="#" onclick="toggleRegisterForm()" style="color: #7f8c8d; font-size: 0.9rem;">
                        Already have an account? Sign in
                    </a>
                </div>
            </form>
        </div>

        <div id="registerInfo" class="card hidden mt-3">
            <h3>Need an Account?</h3>
            <p style="color: #7f8c8d; margin-bottom: 1rem;">
                Admin console access is restricted to authorized personnel only. 
                Contact your system administrator to request access.
            </p>
            <p style="color: #7f8c8d; font-size: 0.9rem;">
                <strong>For developers:</strong> You can register a user account using the 
                <code>POST /auth/register</code> API endpoint, then use those credentials to access the admin console.
            </p>
        </div>
    </div>

    <script>
        // Handle URL parameters for error/success messages
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            if (urlParams.get('error')) {
                showError('Invalid email or password. Please try again.');
            }
            
            if (urlParams.get('logout')) {
                showSuccess('You have been successfully logged out.');
            }
            
            if (urlParams.get('expired')) {
                showError('Your session has expired. Please log in again.');
            }
            
            if (urlParams.get('registered')) {
                showSuccess('Admin account registered successfully! You can now sign in.');
            }
            
            if (urlParams.get('error') === 'registration_failed') {
                showError('Registration failed. Please try again or contact support.');
            }
            
            if (urlParams.get('error') === 'insufficient_privileges') {
                showError('Access denied. Admin privileges required.');
            }
        });

        // Handle form submission with loading state
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            showLoading();
            // Let the form submit normally to /admin/login
        });

        // Handle admin registration form submission
        document.getElementById('adminRegisterForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            
            if (password !== confirmPassword) {
                showError('Passwords do not match. Please try again.');
                return;
            }
            
            if (password.length < 8) {
                showError('Password must be at least 8 characters long.');
                return;
            }
            
            showRegisterLoading();
            
            // Submit the form
            e.target.submit();
        });

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            
            successDiv.classList.add('hidden');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function showSuccess(message) {
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            
            errorDiv.classList.add('hidden');
            successDiv.textContent = message;
            successDiv.classList.remove('hidden');
        }

        function showLoading() {
            const submitBtn = document.querySelector('#loginForm button[type="submit"]');
            submitBtn.innerHTML = '<span class="spinner"></span>Signing In...';
            submitBtn.disabled = true;
        }

        function showRegisterLoading() {
            const submitBtn = document.querySelector('#adminRegisterForm button[type="submit"]');
            submitBtn.innerHTML = '<span class="spinner"></span>Registering...';
            submitBtn.disabled = true;
        }

        function hideLoading() {
            const loginBtn = document.querySelector('#loginForm button[type="submit"]');
            const registerBtn = document.querySelector('#adminRegisterForm button[type="submit"]');
            
            if (loginBtn) {
                loginBtn.textContent = 'Sign In';
                loginBtn.disabled = false;
            }
            
            if (registerBtn) {
                registerBtn.textContent = 'Register Admin Account';
                registerBtn.disabled = false;
            }
        }

        function toggleRegisterForm() {
            const loginCard = document.querySelector('.card');
            const registerForm = document.getElementById('registerForm');
            const registerInfo = document.getElementById('registerInfo');
            
            // Hide register info if visible
            registerInfo.classList.add('hidden');
            
            // Toggle between login and register forms
            loginCard.classList.toggle('hidden');
            registerForm.classList.toggle('hidden');
            
            // Clear any error messages
            document.getElementById('errorMessage').classList.add('hidden');
            document.getElementById('successMessage').classList.add('hidden');
        }

        function showRegisterInfo() {
            const registerInfo = document.getElementById('registerInfo');
            registerInfo.classList.toggle('hidden');
        }
    </script>
</body>
</html>
